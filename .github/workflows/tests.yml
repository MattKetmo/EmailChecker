name: CI

on:
    push:
        branches: [master]
    pull_request:

jobs:
    test:
        runs-on: ubuntu-latest

        strategy:
            fail-fast: false
            matrix:
                php-version:
                    - '8.0'
                    - '8.1'
                    - '8.2'
                    - '8.3'
                    - '8.4'
                    - '8.5'
                dependencies: [highest]
                include:
                    - php-version: '8.0'
                      dependencies: lowest

        name: PHP ${{ matrix.php-version }} ${{ matrix.dependencies }}

        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Setup PHP
              uses: shivammathur/setup-php@v2
              with:
                  php-version: ${{ matrix.php-version }}
                  coverage: none

            - name: Install Composer dependencies (${{ matrix.dependencies }})
              uses: ramsey/composer-install@v3
              with:
                  dependency-versions: ${{ matrix.dependencies }}

            - name: Run tests
              run: composer test

    lint:
        runs-on: ubuntu-latest

        name: PHP Cs Fixer

        steps:
            -   name: Checkout code
                uses: actions/checkout@v4

            -   name: Setup PHP
                uses: shivammathur/setup-php@v2
                with:
                    php-version: 8.5
                    coverage: none

            -   name: Install Composer dependencies
                uses: ramsey/composer-install@v3

            -   name: Run lint
                run: composer lint
